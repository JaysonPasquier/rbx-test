-- BGSI Premium Hub (Rayfield v2.1+) with Pet/Codes Data
-- Key: uIeCsXNDMliclXkKGlfNwXHZHFblrJZl
-- Dark theme, white text, semi-transparent

local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer

-- === PREMIUM CHECK ===
local PREMIUM_KEY = "uIeCsXNDMliclXkKGlfNwXHZHFblrJZl"
if getgenv().script_key ~= PREMIUM_KEY then return end

-- === RAYFIELD v2.1+ (Dark Theme) ===
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()
local Window = Rayfield:CreateWindow({
   Name = "ðŸ§¼ BGSI Premium Hub v2.1",
   LoadingTitle = "Loading BGSI Hub...",
   LoadingSubtitle = "by sã“rã´ãŠ | Dark Edition",
   ConfigurationSaving = {Enabled = false},
   Discord = {Enabled = false},
   KeySystem = false
})

-- Force Dark Theme + White Text
Rayfield:SetTheme("Dark")

-- === STATE ===
local state = {
    startTime = tick(),
    autoBlow = false,
    autoHatch = false,
    riftPriority = nil,
    eggPriority = nil,
    webhookUrl = "",
    webhookStats = true,
    webhookHatch = {Common=false, Unique=false, Rare=false, Epic=false, Legendary=false, Secret=true},
    currentRifts = {},
    currentEggs = {},
    stats = {bubbles=0, hatches=0, coins=0, bubbleStock=0, gems=0},
    lastPetRarity = nil
}

-- === PETS & CODES DATA ===
local petData = require(RS.Shared.Data.Pets)
local codeData = require(RS.Shared.Data.Codes)
local rarities = {"Common", "Unique", "Rare", "Epic", "Legendary", "Secret"}

-- === WEBHOOK SYSTEM ===
local function SendWebhook(url, msg)
    local headers = {["Content-Type"] = "application/json"}
    local data = {["content"] = msg}
    pcall(function()
        request({Url=url, Method="POST", Headers=headers, Body=HttpService:JSONEncode(data)})
    end)
end

-- === STATS TRACKER ===
local function updateStats()
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        state.stats.bubbles = leaderstats:FindFirstChild("Bubbles") and leaderstats.Bubbles.Value or 0
        state.stats.hatches = leaderstats:FindFirstChild("Hatches") and leaderstats.Hatches.Value or 0
    end

    -- UI Currency (Coins, Bubble Stock, Gems)
    local screenGui = playerGui:FindFirstChild("ScreenGui")
    if screenGui then
        local hud = screenGui:FindFirstChild("HUD", true)
        if hud then
            local currencyFrame = hud:FindFirstChild("Left", true):FindFirstChild("Currency", true)
            if currencyFrame then
                for _, currency in pairs(currencyFrame:GetChildren()) do
                    local label = currency:FindFirstChild("Frame", true):FindFirstChild("Label")
                    if label and label:IsA("TextLabel") then
                        local value = tonumber(label.Text:match("%d+")) or 0
                        local name = currency.Name:lower()
                        if name == "coins" then state.stats.coins = value end
                        if name == "bubble" then state.stats.bubbleStock = value end
                        if name == "gems" then state.stats.gems = value end
                    end
                end
            end
        end
    end
end

-- === RIFT SCANNER ===
local function scanRifts()
    state.currentRifts = {}
    local rendered = Workspace:FindFirstChild("Rendered")
    if rendered and rendered:FindFirstChild("Rifts") then
        for _, rift in pairs(rendered.Rifts:GetChildren()) do
            local display = rift:FindFirstChild("Display")
            if display then
                local timer = display:FindFirstChild("Timer")
                local icon = display:FindFirstChild("Icon")
                local luck = icon and icon:FindFirstChild("Luck")
                table.insert(state.currentRifts, {
                    name = rift.Name,
                    timer = timer and timer.Text or "?",
                    luck = luck and luck.Text or "?",
                    instance = rift
                })
            end
        end
    end
end

-- === EGG SCANNER ===
local function scanEggs()
    state.currentEggs = {}
    local rendered = Workspace:FindFirstChild("Rendered")
    if rendered then
        for _, folder in pairs(rendered:GetChildren()) do
            if folder.Name:lower():find("chuncker") then
                for _, egg in pairs(folder:GetChildren()) do
                    if egg.Name ~= "Coming Soon" then
                        table.insert(state.currentEggs, {
                            name = egg.Name,
                            instance = egg
                        })
                    end
                end
            end
        end
    end
end

-- === TELEPORT ===
local function tpToModel(model)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = player.Character.HumanoidRootPart
        local cf = model:FindFirstChild("EggPlatformSpawn") and model.EggPlatformSpawn:GetModelCFrame() or model:GetModelCFrame()
        hrp.CFrame = cf + Vector3.new(0, 5, 0)
    end
end

-- === MAIN LOOP ===
task.spawn(function()
    while true do
        updateStats()
        scanRifts()
        scanEggs()

        -- Auto Blow (Dex: ReplicatedStorage.Remotes.BlowBubbleRemote)
        if state.autoBlow then
            -- TODO: RS.Remotes.BlowBubbleRemote:FireServer()
            task.wait(math.random(45, 55)/1000)
        end

        -- Auto Hatch Priority
        if state.autoHatch and state.eggPriority then
            for _, egg in pairs(state.currentEggs) do
                if egg.name == state.eggPriority then
                    tpToModel(egg.instance)
                    break
                end
            end
        end

        -- Rift Priority
        if state.riftPriority then
            for _, rift in pairs(state.currentRifts) do
                if rift.name == state.riftPriority then
                    tpToModel(rift.instance)
                    break
                end
            end
        end

        task.wait(0.1)
    end
end)

-- === UI TABS ===

-- ðŸ  MAIN TAB (Stats + Runtime)
local MainTab = Window:CreateTab("ðŸ  Main", 4483362458)
MainTab:CreateLabel("Runtime & Stats")
local runtimeLabel = MainTab:CreateLabel("Runtime: 00:00:00")
local statsSection = MainTab:CreateSection("Live Stats")

local bubblesLabel = MainTab:CreateLabel("Bubbles: 0")
local hatchesLabel = MainTab:CreateLabel("Hatches: 0")
local coinsLabel = MainTab:CreateLabel("Coins: 0")
local bubbleStockLabel = MainTab:CreateLabel("Bubble Stock: 0")
local gemsLabel = MainTab:CreateLabel("Gems: 0")

-- ðŸ”§ FARMING TAB
local FarmTab = Window:CreateTab("ðŸ”§ Farming", 4483362458)
FarmTab:CreateToggle({
    Name = "ðŸ§¼ Auto Blow Bubble (50ms)",
    CurrentValue = false,
    Flag = "BGSIAutoBlow",
    Callback = function(Value)
        state.autoBlow = Value
    end
})

-- ðŸ¥š EGGS TAB
local EggsTab = Window:CreateTab("ðŸ¥š Eggs", 4483362458)
local eggDropdown = EggsTab:CreateDropdown({
    Name = "Select Egg (Teleport + Priority)",
    Options = {},
    CurrentOption = "",
    MultipleOptions = false,
    Flag = "BGSIEggSelect",
    Callback = function(Option)
        state.eggPriority = Option
        -- Instant teleport
        for _, egg in pairs(state.currentEggs) do
            if egg.name == Option then
                tpToModel(egg.instance)
                break
            end
        end
    end
})

EggsTab:CreateToggle({
    Name = "Auto Hatch Selected Egg",
    CurrentValue = false,
    Flag = "BGSIAutoHatch",
    Callback = function(Value)
        state.autoHatch = Value
    end
})

EggsTab:CreateButton({
    Name = "ðŸ”„ Refresh Egg List",
    Callback = function()
        scanEggs()
        local names = {}
        for _, egg in pairs(state.currentEggs) do table.insert(names, egg.name) end
        eggDropdown:Refresh(names, true)
    end
})

-- ðŸŒŒ RIFTS TAB
local RiftsTab = Window:CreateTab("ðŸŒŒ Rifts", 4483362458)
local riftDropdown = RiftsTab:CreateDropdown({
    Name = "Active Rifts (Timer | Luck)",
    Options = {},
    CurrentOption = "",
    MultipleOptions = false,
    Flag = "BGSIRiftSelect",
    Callback = function(Option)
        local riftName = Option:match("^(.+?) |")
        state.riftPriority = riftName
        for _, rift in pairs(state.currentRifts) do
            if rift.name == riftName then
                tpToModel(rift.instance)
                break
            end
        end
    end
})

RiftsTab:CreateButton({
    Name = "ðŸ”„ Refresh Rifts",
    Callback = function()
        scanRifts()
        local names = {}
        for _, rift in pairs(state.currentRifts) do
            table.insert(names, rift.name .. " | " .. rift.timer .. " | " .. rift.luck)
        end
        riftDropdown:Refresh(names, true)
    end
})

-- ðŸ“Š WEBHOOKS TAB
local WebhookTab = Window:CreateTab("ðŸ“Š Webhooks", 4483362458)
WebhookTab:CreateInput({
    Name = "Discord Webhook URL",
    PlaceholderText = "https://discord.com/api/webhooks/...",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        state.webhookUrl = Text
    end
})

WebhookTab:CreateToggle({
    Name = "ðŸ“ˆ Send Stats (non-zero only)",
    CurrentValue = true,
    Flag = "WebhookStats",
    Callback = function(Value)
        state.webhookStats = Value
    end
})

-- Rarity Webhook Toggles
local raritySection = WebhookTab:CreateSection("Hatch Notifications")
for _, rarity in ipairs(rarities) do
    WebhookTab:CreateToggle({
        Name = rarity .. " Pets",
        CurrentValue = (rarity == "Secret" or rarity == "Legendary"),
        Flag = "Webhook" .. rarity,
        Callback = function(Value)
            state.webhookHatch[rarity] = Value
        end
    })
end

WebhookTab:CreateButton({
    Name = "ðŸ§ª Test Webhook",
    Callback = function()
        if state.webhookUrl == "" then return Rayfield:Notify({Title="Error", Content="Enter webhook URL first!", Duration=3}) end

        local msg = "**ðŸ§¼ BGSI Stats** `" .. os.date("%H:%M:%S") .. "`\n"
        local fields = {}
        if state.stats.bubbles > 0 then table.insert(fields, "Bubbles: **" .. state.stats.bubbles .. "**") end
        if state.stats.hatches > 0 then table.insert(fields, "Hatches: **" .. state.stats.hatches .. "**") end
        if state.stats.coins > 0 then table.insert(fields, "Coins: **" .. state.stats.coins .. "**") end
        if state.stats.gems > 0 then table.insert(fields, "Gems: **" .. state.stats.gems .. "**") end

        if #fields > 0 then
            SendWebhook(state.webhookUrl, msg .. table.concat(fields, "\n"))
            Rayfield:Notify({Title="Success", Content="Webhook sent!", Duration=2, Image=4483362458})
        end
    end
})

-- === PETS & CODES DISPLAY ===
local DataTab = Window:CreateTab("ðŸ“‹ Data", 4483362458)

-- Pet Rarity List
local petSection = DataTab:CreateSection("Pet Rarities (ReplicatedStorage.Shared.Data.Pets)")
for petName, petData in pairs(petData) do
    if type(petData) == "table" and petData.Rarity then
        DataTab:CreateLabel(petName .. " [" .. petData.Rarity .. "]")
    end
end

-- Active Codes
local codeSection = DataTab:CreateSection("Active Codes (ReplicatedStorage.Shared.Data.Codes)")
for codeName, rewards in pairs(codeData) do
    DataTab:CreateLabel("`" .. codeName .. "` â†’ " .. HttpService:JSONEncode(rewards):sub(1, 100) .. "...")
end

-- === UI UPDATE LOOP ===
task.spawn(function()
    while true do
        -- Update main stats display
        local runtime = tick() - state.startTime
        local h, m, s = math.floor(runtime/3600), math.floor((runtime%3600)/60), math.floor(runtime%60)

        -- Webhook stats (non-zero only)
        if state.webhookUrl ~= "" and state.webhookStats then
            local msg = "**ðŸ§¼ BGSI Hub** `" .. player.Name .. "`\n"
            local fields = {}
            if state.stats.bubbles > 0 then table.insert(fields, "Bubbles: " .. state.stats.bubbles) end
            if state.stats.hatches > 0 then table.insert(fields, "Hatches: " .. state.stats.hatches) end
            if state.stats.coins > 0 then table.insert(fields, "Coins: " .. state.stats.coins) end
            if state.stats.gems > 0 then table.insert(fields, "Gems: " .. state.stats.gems) end

            if #fields > 0 and tick() % 60 < 1 then -- Once per minute
                SendWebhook(state.webhookUrl, msg .. table.concat(fields, "\n"))
            end
        end

        task.wait(1)
    end
end)

-- Initial scans
scanRifts()
scanEggs()

print("ðŸ§¼ BGSI Premium Hub v2.1+ LOADED (Rayfield Dark)")
game.StarterGui:SetCore("SendNotification", {
    Title = "ðŸ§¼ BGSI Hub";
    Text = "Rayfield Dark loaded! Dex remotes next...";
    Duration = 5
})
