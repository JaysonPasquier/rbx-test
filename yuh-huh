-- BGSI Premium Hub v2026 - COMPLETE WIDE/SHORT MOBILE VERSION
-- Key: uIeCsXNDMliclXkKGlfNwXHZHFblrJZl
-- âœ… AUTO-SHOW + WIDE/SHORT + MOBILE PERFECT + MINIMIZE TO TOP BAR

getgenv().script_key = "uIeCsXNDMliclXkKGlfNwXHZHFblrJZl"

local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

print("ğŸ§¼ BGSI Premium Hub v2026 - MOBILE PERFECT LOADING...")

-- Load Linoria Library (2026 Compatible)
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/Library.lua"))()
local ThemeManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/addons/SaveManager.lua"))()

-- === CREATE MOBILE-PERFECT WINDOW ===
local Window = Library:CreateWindow({
    Name = "ğŸ§¼ BGSI Premium Hub v2026",
    HidePremium = false,
    Center = true,
    AutoShow = true,
    Size = UDim2.new(0, 520, 0, 320),  -- âœ… WIDE (520px) + SHORT (320px)
    Position = UDim2.new(0.5, -260, 0.5, -160),  -- âœ… Perfect mobile center
})

-- === MINIMIZE STATE ===
local isMinimized = false
local originalSize = UDim2.new(0, 520, 0, 320)
local originalPosition = UDim2.new(0.5, -260, 0.5, -160)

-- Wait for frame to render
task.wait(0.2)
local Frame = Window.Frame

-- === TOP-RIGHT MINIMIZE BUTTON ===
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeBtn"
MinimizeButton.Size = UDim2.new(0, 34, 0, 30)
MinimizeButton.Position = UDim2.new(1, -39, 0, 6)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
MinimizeButton.Text = "â–"
MinimizeButton.TextColor3 = Color3.new(1,1,1)
MinimizeButton.TextSize = 20
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Parent = Frame
MinimizeButton.ZIndex = 999

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 8)
MinCorner.Parent = MinimizeButton

local MinGradient = Instance.new("UIGradient")
MinGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 100, 100)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 50, 50))
}
MinGradient.Rotation = 45
MinGradient.Parent = MinimizeButton

local MinStroke = Instance.new("UIStroke")
MinStroke.Color = Color3.new(1,1,1)
MinStroke.Thickness = 2
MinStroke.Parent = MinimizeButton

-- === MINIMIZE/MAXIMIZE FUNCTION ===
local function toggleMinimize()
    isMinimized = not isMinimized

    if isMinimized then
        -- MINIMIZE: Shrink to top bar only
        TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {
            Size = UDim2.new(0, 300, 0, 42),
            Position = UDim2.new(0.5, -150, 0, 15)
        }):Play()

        -- Hide all tab content
        for _, tab in pairs(Window.Tabs) do
            if tab.Content then
                tab.Content.Visible = false
            end
        end

        MinimizeButton.Text = "ğŸ“±"
        MinimizeButton.BackgroundColor3 = Color3.fromRGB(85, 255, 85)
        Library:Notify("ğŸ“± Menu minimized to top bar!", 2)

    else
        -- MAXIMIZE: Restore full size
        TweenService:Create(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {
            Size = originalSize,
            Position = originalPosition
        }):Play()

        -- Show tab content
        for _, tab in pairs(Window.Tabs) do
            if tab.Content then
                tab.Content.Visible = true
            end
        end

        MinimizeButton.Text = "â–"
        MinimizeButton.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
        Library:Notify("âœ… Menu expanded!", 2)
    end
end

MinimizeButton.MouseButton1Click:Connect(toggleMinimize)
MinimizeButton.TouchTap:Connect(toggleMinimize)

-- === MOBILE-PERFECT DRAG SYSTEM (Title bar only) ===
local dragging = false
local dragStart = nil
local startPos = nil

Frame.InputBegan:Connect(function(input)
    local frameAbsPos = Frame.AbsolutePosition
    local frameAbsSize = Frame.AbsoluteSize

    -- Only allow dragging from TITLE BAR (top 50px) when NOT minimized
    if not isMinimized and input.Position.Y >= frameAbsPos.Y and input.Position.Y <= frameAbsPos.Y + 50 and
       (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then

        dragging = true
        dragStart = input.Position
        startPos = Frame.Position

        -- Visual feedback
        TweenService:Create(MinimizeButton, TweenInfo.new(0.1), {
            Size = UDim2.new(0, 38, 0, 34),
            Position = UDim2.new(1, -43, 0, 4)
        }):Play()
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and not isMinimized and
       (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
                                  startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
        TweenService:Create(MinimizeButton, TweenInfo.new(0.1), {
            Size = UDim2.new(0, 34, 0, 30),
            Position = UDim2.new(1, -39, 0, 6)
        }):Play()
    end
end)

-- === STATE MANAGEMENT ===
local state = {
    autoBlow = false,
    autoHatch = false,
    riftPriority = nil,
    eggPriority = nil,
    webhookUrl = "",
    webhookStats = true,
    currentRifts = {},
    currentEggs = {},
    stats = {bubbles=0, hatches=0, coins=0, bubbleStock=0, gems=0},
    startTime = tick(),
    labels = {},
    dropdowns = {}
}

-- === PETS & CODES DATA ===
local petData, codeData
pcall(function()
    petData = require(RS.Shared.Data.Pets)
    codeData = require(RS.Shared.Data.Codes)
end)

-- === UTILITY FUNCTIONS ===
local function SendWebhook(url, msg)
    pcall(function()
        request({
            Url = url,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({content = msg})
        })
    end)
end

local function updateStats()
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        state.stats.bubbles = leaderstats:FindFirstChild("Bubbles") and leaderstats.Bubbles.Value or 0
        state.stats.hatches = leaderstats:FindFirstChild("Hatches") and leaderstats.Hatches.Value or 0
    end

    pcall(function()
        local screenGui = playerGui:FindFirstChild("ScreenGui")
        if screenGui and screenGui:FindFirstChild("HUD") then
            local currencyFrame = screenGui.HUD:FindFirstChild("Left", true):FindFirstChild("Currency", true)
            if currencyFrame then
                for _, currency in pairs(currencyFrame:GetChildren()) do
                    local label = currency:FindFirstChild("Frame", true):FindFirstChild("Label")
                    if label then
                        local value = tonumber(label.Text:match("%d+")) or 0
                        local name = currency.Name:lower()
                        if name == "coins" then state.stats.coins = value end
                        if name == "bubble" then state.stats.bubbleStock = value end
                        if name == "gems" then state.stats.gems = value end
                    end
                end
            end
        end
    end)
end

local function scanRifts()
    state.currentRifts = {}
    pcall(function()
        local rendered = Workspace:FindFirstChild("Rendered")
        if rendered and rendered:FindFirstChild("Rifts") then
            for _, rift in pairs(rendered.Rifts:GetChildren()) do
                local display = rift:FindFirstChild("Display")
                if display then
                    local timer = display:FindFirstChild("Timer")
                    local icon = display:FindFirstChild("Icon")
                    local luck = icon and icon:FindFirstChild("Luck")
                    table.insert(state.currentRifts, {
                        name = rift.Name,
                        timer = timer and timer.Text or "00:00",
                        luck = luck and luck.Text or "x1",
                        instance = rift
                    })
                end
            end
        end
    end)
end

local function scanEggs()
    state.currentEggs = {}
    pcall(function()
        local rendered = Workspace:FindFirstChild("Rendered")
        if rendered then
            for _, folder in pairs(rendered:GetChildren()) do
                if folder.Name:lower():find("chuncker") then
                    for _, egg in pairs(folder:GetChildren()) do
                        if egg.Name ~= "Coming Soon" then
                            table.insert(state.currentEggs, {name = egg.Name, instance = egg})
                        end
                    end
                end
            end
        end
    end)
end

local function tpToModel(model)
    pcall(function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local cf = model:FindFirstChild("EggPlatformSpawn")
                and model.EggPlatformSpawn:GetModelCFrame()
                or model:GetModelCFrame()
            hrp.CFrame = cf + Vector3.new(0, 5, 0)
        end
    end)
end

-- === TABS ===
local MainTab = Window:AddTab("ğŸ  Main")
local FarmTab = Window:AddTab("ğŸ”§ Farm")
local EggsTab = Window:AddTab("ğŸ¥š Eggs")
local RiftsTab = Window:AddTab("ğŸŒŒ Rifts")
local WebTab = Window:AddTab("ğŸ“Š Webhook")
local DataTab = Window:AddTab("ğŸ“‹ Data")

-- === MAIN TAB - Live Stats ===
local MainGroupBox = MainTab:AddLeftGroupbox("ğŸ“Š Live Statistics")
state.labels.runtime = MainGroupBox:AddLabel("Runtime: 00:00:00")
state.labels.bubbles = MainGroupBox:AddLabel("Bubbles: 0")
state.labels.hatches = MainGroupBox:AddLabel("Hatches: 0")
state.labels.coins = MainGroupBox:AddLabel("Coins: 0")
state.labels.bubbleStock = MainGroupBox:AddLabel("Bubble Stock: 0")
state.labels.gems = MainGroupBox:AddLabel("Gems: 0")

-- === FARM TAB ===
local FarmGroupBox = FarmTab:AddLeftGroupbox("ğŸ¤– Auto Farming")
FarmGroupBox:AddToggle("AutoBlow", {
    Text = "ğŸ§¼ Auto Blow Bubbles",
    Default = false,
    Callback = function(value)
        state.autoBlow = value
        Library:Notify("Auto Blow " .. (value and "âœ… Enabled" or "âŒ Disabled"), 2)
    end
})

-- === EGGS TAB ===
local EggGroupBox = EggsTab:AddLeftGroupbox("ğŸ¥š Egg Scanner")
state.dropdowns.egg = EggGroupBox:AddDropdown("EggSelect", {
    Values = {},
    AllowNull = true,
    Text = "No eggs found - Click Refresh",
    Callback = function(option)
        if option then
            state.eggPriority = option
            for _, egg in pairs(state.currentEggs) do
                if egg.name == option then
                    tpToModel(egg.instance)
                    Library:Notify("ğŸš€ Teleported to " .. option, 2)
                    break
                end
            end
        end
    end
})

EggGroupBox:AddToggle("AutoHatch", {
    Text = "ğŸ”„ Auto Hatch Priority Egg",
    Default = false,
    Callback = function(value)
        state.autoHatch = value
        Library:Notify("Auto Hatch " .. (value and "âœ… Enabled" or "âŒ Disabled"), 2)
    end
})

EggGroupBox:AddButton({
    Text = "ğŸ”„ Refresh Eggs",
    Func = function()
        scanEggs()
        local names = {}
        for _, egg in pairs(state.currentEggs) do
            table.insert(names, egg.name)
        end
        state.dropdowns.egg:Refresh(names)
        state.dropdowns.egg:Set("")
        Library:Notify("ğŸ¥š Found " .. #names .. " eggs!", 2)
    end
})

-- === RIFTS TAB ===
local RiftGroupBox = RiftsTab:AddLeftGroupbox("ğŸŒŒ Live Rift Scanner")
state.dropdowns.rift = RiftGroupBox:AddDropdown("RiftSelect", {
    Values = {},
    AllowNull = true,
    Text = "No rifts found - Click Refresh",
    Callback = function(option)
        if option then
            local name = option:match("^(.+?) |") or option
            state.riftPriority = name
            for _, rift in pairs(state.currentRifts) do
                if rift.name == name then
                    tpToModel(rift.instance)
                    Library:Notify("ğŸŒŒ Teleported to " .. name, 2)
                    break
                end
            end
        end
    end
})

RiftGroupBox:AddButton({
    Text = "ğŸ”„ Refresh Rifts",
    Func = function()
        scanRifts()
        local names = {}
        for _, rift in pairs(state.currentRifts) do
            table.insert(names, rift.name .. " | " .. rift.timer .. " | " .. rift.luck)
        end
        state.dropdowns.rift:Refresh(names)
        state.dropdowns.rift:Set("")
        Library:Notify("ğŸŒŒ Found " .. #names .. " rifts!", 2)
    end
})

-- === WEBHOOK TAB ===
local WebGroupBox = WebTab:AddLeftGroupbox("ğŸ’¬ Discord Webhook")
state.webhookInput = WebGroupBox:AddInput("WebhookURL", {
    Text = "Discord Webhook URL",
    Default = "",
    Placeholder = "https://discord.com/api/webhooks/...",
    Callback = function(text)
        state.webhookUrl = text
    end
})

WebGroupBox:AddToggle("StatsWebhook", {
    Text = "ğŸ“Š Send Live Stats",
    Default = true,
    Callback = function(value)
        state.webhookStats = value
    end
})

WebGroupBox:AddButton({
    Text = "ğŸ§ª Test Webhook",
    Func = function()
        if state.webhookUrl == "" then
            Library:Notify("âŒ Enter webhook URL first!", 3)
            return
        end
        local msg = "**ğŸ§¼ BGSI Stats** `" .. os.date("%H:%M") .. "`\n"
        local fields = {}
        if state.stats.bubbles > 0 then table.insert(fields, "Bubbles: " .. state.stats.bubbles) end
        if state.stats.hatches > 0 then table.insert(fields, "Hatches: " .. state.stats.hatches) end
        if state.stats.coins > 0 then table.insert(fields, "Coins: " .. state.stats.coins) end
        SendWebhook(state.webhookUrl, msg .. table.concat(fields, "\n"))
        Library:Notify("âœ… Test message sent!", 2)
    end
})

-- === DATA TAB ===
if petData then
    local PetGroupBox = DataTab:AddLeftGroupbox("ğŸ¾ Pet Rarities")
    local count = 0
    for petName, data in pairs(petData) do
        if data.Rarity and count < 20 then  -- Limit to 20 pets for space
            PetGroupBox:AddLabel(petName .. " [" .. data.Rarity .. "]")
            count = count + 1
        end
    end
    if count == 0 then
        PetGroupBox:AddLabel("No pet data available")
    end
end

-- Initialize addons
ThemeManager:SetLibrary(Library)
ThemeManager:ApplyToTab(MainTab)
SaveManager:SetLibrary(Library)

-- === MAIN LOOPS ===
spawn(function()
    while wait(0.1) do
        updateStats()
        scanRifts()
        scanEggs()

        if state.autoBlow then
            -- Uncomment when ready: RS.Remotes.BlowBubbleRemote:FireServer()
        end

        if state.autoHatch and state.eggPriority then
            for _, egg in pairs(state.currentEggs) do
                if egg.name == state.eggPriority then
                    tpToModel(egg.instance)
                    break
                end
            end
        end
    end
end)

spawn(function()
    while wait(1) do
        local runtime = tick() - state.startTime
        local h,m,s = math.floor(runtime/3600), math.floor((runtime%3600)/60), math.floor(runtime%60)

        pcall(function()
            state.labels.runtime:Set("Runtime: " .. string.format("%02d:%02d:%02d", h,m,s))
            state.labels.bubbles:Set("Bubbles: " .. state.stats.bubbles)
            state.labels.hatches:Set("Hatches: " .. state.stats.hatches)
            state.labels.coins:Set("Coins: " .. state.stats.coins)
            state.labels.bubbleStock:Set("Bubble Stock: " .. state.stats.bubbleStock)
            state.labels.gems:Set("Gems: " .. state.stats.gems)
        end)

        if state.webhookStats and state.webhookUrl ~= "" and tick()%60 < 1 then
            local msg = "**ğŸ§¼ BGSI** | " .. player.Name .. " | " .. os.date("%H:%M") .. "\n"
            local fields = {}
            if state.stats.bubbles > 0 then table.insert(fields, "Bubbles: " .. state.stats.bubbles) end
            if state.stats.hatches > 0 then table.insert(fields, "Hatches: " .. state.stats.hatches) end
            if state.stats.coins > 0 then table.insert(fields, "Coins: " .. state.stats.coins) end
            SendWebhook(state.webhookUrl, msg .. table.concat(fields, "\n"))
        end
    end
end)

-- Initial scans
scanEggs()
scanRifts()

Library:Notify("ğŸ§¼ BGSI v2026 MOBILE HUB READY! ğŸ®\nâ– Top-right = Minimize | Drag title bar", 6)
print("ğŸ‰ BGSI Premium Hub v2026 - COMPLETE MOBILE VERSION LOADED!")
print("âœ… Auto-shows | âœ… Wide/Short | âœ… Drag title | âœ… Minimize top bar")
