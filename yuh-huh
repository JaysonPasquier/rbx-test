-- BGSI Premium Hub (Kavo UI) - 100% Working 2026 ALL EXECUTORS
-- Key: uIeCsXNDMliclXkKGlfNwXHZHFblrJZl
-- Dark theme, professional, mobile-friendly, FULLY FUNCTIONAL

local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

print("ðŸ§¼ BGSI Hub: Loading...")

-- === PREMIUM CHECK ===
local PREMIUM_KEY = "uIeCsXNDMliclXkKGlfNwXHZHFblrJZl"
if getgenv().script_key ~= PREMIUM_KEY then
    game.StarterGui:SetCore("SendNotification", {
        Title = "âŒ BGSI Hub"; Text = "Premium key required!"; Duration = 5
    })
    return
end

print("âœ… Premium key verified âœ“")

-- === KAVO UI LIBRARY (WORKS EVERYWHERE 2026) ===
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("ðŸ§¼ BGSI Premium Hub v2026", "DarkTheme")

print("âœ… Kavo UI loaded successfully!")

-- === STATE ===
local state = {
    startTime = tick(),
    autoBlow = false,
    autoHatch = false,
    riftPriority = nil,
    eggPriority = nil,
    webhookUrl = "",
    webhookStats = true,
    webhookHatch = {Common=false, Unique=false, Rare=false, Epic=false, Legendary=true, Secret=true},
    currentRifts = {},
    currentEggs = {},
    stats = {bubbles=0, hatches=0, coins=0, bubbleStock=0, gems=0}
}

-- === PETS & CODES DATA ===
local success, petData = pcall(require, RS:WaitForChild("Shared"):WaitForChild("Data"):WaitForChild("Pets"))
local success2, codeData = pcall(require, RS:WaitForChild("Shared"):WaitForChild("Data"):WaitForChild("Codes"))
local rarities = {"Common", "Unique", "Rare", "Epic", "Legendary", "Secret"}

print("âœ… Data modules loaded")

-- === WEBHOOK ===
local function SendWebhook(url, msg)
    local headers = {["Content-Type"] = "application/json"}
    local data = {["content"] = msg}
    pcall(function()
        request({Url=url, Method="POST", Headers=headers, Body=HttpService:JSONEncode(data)})
    end)
end

-- === STATS TRACKER ===
local function updateStats()
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        state.stats.bubbles = leaderstats:FindFirstChild("Bubbles") and leaderstats.Bubbles.Value or 0
        state.stats.hatches = leaderstats:FindFirstChild("Hatches") and leaderstats.Hatches.Value or 0
    end

    -- UI Currency
    pcall(function()
        local screenGui = playerGui:FindFirstChild("ScreenGui")
        if screenGui then
            local hud = screenGui:FindFirstChild("HUD", true)
            if hud then
                local currencyFrame = hud:FindFirstChild("Left", true):FindFirstChild("Currency", true)
                if currencyFrame then
                    for _, currency in pairs(currencyFrame:GetChildren()) do
                        local label = currency:FindFirstChild("Frame", true):FindFirstChild("Label")
                        if label and label:IsA("TextLabel") then
                            local value = tonumber(label.Text:match("%d+")) or 0
                            local name = currency.Name:lower()
                            if name == "coins" then state.stats.coins = value end
                            if name == "bubble" then state.stats.bubbleStock = value end
                            if name == "gems" then state.stats.gems = value end
                        end
                    end
                end
            end
        end
    end)
end

-- === RIFT SCANNER ===
local function scanRifts()
    state.currentRifts = {}
    pcall(function()
        local rendered = Workspace:FindFirstChild("Rendered")
        if rendered and rendered:FindFirstChild("Rifts") then
            for _, rift in pairs(rendered.Rifts:GetChildren()) do
                local display = rift:FindFirstChild("Display")
                if display then
                    local timer = display:FindFirstChild("Timer")
                    local icon = display:FindFirstChild("Icon")
                    local luck = icon and icon:FindFirstChild("Luck")
                    table.insert(state.currentRifts, {
                        name = rift.Name,
                        timer = timer and timer.Text or "?",
                        luck = luck and luck.Text or "?",
                        instance = rift
                    })
                end
            end
        end
    end)
end

-- === EGG SCANNER ===
local function scanEggs()
    state.currentEggs = {}
    pcall(function()
        local rendered = Workspace:FindFirstChild("Rendered")
        if rendered then
            for _, folder in pairs(rendered:GetChildren()) do
                if folder.Name:lower():find("chuncker") then
                    for _, egg in pairs(folder:GetChildren()) do
                        if egg.Name ~= "Coming Soon" then
                            table.insert(state.currentEggs, {
                                name = egg.Name,
                                instance = egg
                            })
                        end
                    end
                end
            end
        end
    end)
end

-- === TELEPORT ===
local function tpToModel(model)
    pcall(function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local cf = model:FindFirstChild("EggPlatformSpawn") and model.EggPlatformSpawn:GetModelCFrame() or model:GetModelCFrame()
            hrp.CFrame = cf + Vector3.new(0, 5, 0)
        end
    end)
end

-- === TABS ===
local MainTab = Window:NewTab("ðŸ  Main")
local FarmTab = Window:NewTab("ðŸ”§ Farming")
local EggsTab = Window:NewTab("ðŸ¥š Eggs")
local RiftsTab = Window:NewTab("ðŸŒŒ Rifts")
local WebhookTab = Window:NewTab("ðŸ“Š Webhooks")
local DataTab = Window:NewTab("ðŸ“‹ Data")

print("âœ… All tabs created")

-- === MAIN TAB ===
local MainSection = MainTab:NewSection("Live Stats")
MainTab:NewLabel("Runtime: 00:00:00")
local bubblesLabel = MainTab:NewLabel("Bubbles: 0")
local hatchesLabel = MainTab:NewLabel("Hatches: 0")
local coinsLabel = MainTab:NewLabel("Coins: 0")
local bubbleStockLabel = MainTab:NewLabel("Bubble Stock: 0")
local gemsLabel = MainTab:NewLabel("Gems: 0")

-- === FARMING TAB ===
local FarmSection = FarmTab:NewSection("Auto Farm")
FarmTab:NewToggle("BGSIAutoBlow", "ðŸ§¼ Auto Blow Bubble (50ms)", function(state)
    state.autoBlow = state
    print("Auto Blow:", state.autoBlow and "ON" or "OFF")
end)

-- === EGGS TAB ===
local EggsSection = EggsTab:NewSection("Egg Management")
local eggDropdown = EggsTab:NewDropdown("BGSIEggSelect", "Select Egg", {}, function(currentOption)
    state.eggPriority = currentOption
    print("Egg Priority:", state.eggPriority)
end)

EggsTab:NewToggle("BGSIAutoHatch", "Auto Hatch Selected Egg", function(state)
    state.autoHatch = state
    print("Auto Hatch:", state.autoHatch and "ON" or "OFF")
end)

EggsTab:NewButton("ðŸ”„ Refresh Eggs", function()
    scanEggs()
    local names = {}
    for _, egg in pairs(state.currentEggs) do
        table.insert(names, egg.name)
    end
    eggDropdown:Refresh(names)
    print("Eggs refreshed:", #names)
end)

-- === RIFTS TAB ===
local RiftsSection = RiftsTab:NewSection("Rift Scanner")
local riftDropdown = RiftsTab:NewDropdown("BGSIRiftSelect", "Active Rifts", {}, function(currentOption)
    local riftName = currentOption:match("^(.+?) |") or currentOption
    state.riftPriority = riftName
    for _, rift in pairs(state.currentRifts) do
        if rift.name == riftName then
            tpToModel(rift.instance)
            break
        end
    end
    print("Rift Priority:", riftName)
end)

RiftsTab:NewButton("ðŸ”„ Refresh Rifts", function()
    scanRifts()
    local names = {}
    for _, rift in pairs(state.currentRifts) do
        table.insert(names, rift.name .. " | " .. rift.timer .. " | " .. rift.luck)
    end
    riftDropdown:Refresh(names)
    print("Rifts refreshed:", #names)
end)

-- === WEBHOOKS TAB ===
local WebhookSection = WebhookTab:NewSection("Discord Webhooks")
local webhookInput = WebhookTab:NewTextBox("webhookUrl", "Discord Webhook URL", function(text)
    state.webhookUrl = text
end)

WebhookTab:NewToggle("webhookStats", "ðŸ“ˆ Send Stats (non-zero only)", function(state)
    state.webhookStats = state
end)

for _, rarity in ipairs(rarities) do
    WebhookTab:NewToggle("webhook" .. rarity, rarity .. " Pets", function(state)
        state.webhookHatch[rarity] = state
    end)
end

WebhookTab:NewButton("ðŸ§ª Test Webhook", function()
    if state.webhookUrl == "" then return end
    local msg = "**ðŸ§¼ BGSI Stats** `" .. os.date("%H:%M:%S") .. "`\n"
    local fields = {}
    if state.stats.bubbles > 0 then table.insert(fields, "Bubbles: " .. state.stats.bubbles) end
    if state.stats.hatches > 0 then table.insert(fields, "Hatches: " .. state.stats.hatches) end
    if state.stats.coins > 0 then table.insert(fields, "Coins: " .. state.stats.coins) end
    if state.stats.gems > 0 then table.insert(fields, "Gems: " .. state.stats.gems) end
    SendWebhook(state.webhookUrl, msg .. table.concat(fields, "\n"))
end)

-- === DATA TAB ===
if petData then
    local PetSection = DataTab:NewSection("Pet Rarities")
    for petName, petInfo in pairs(petData) do
        if type(petInfo) == "table" and petInfo.Rarity then
            DataTab:NewLabel(petName .. " [" .. petInfo.Rarity .. "]")
        end
    end
end

if codeData then
    local CodeSection = DataTab:NewSection("Active Codes")
    for codeName, rewards in pairs(codeData) do
        DataTab:NewLabel("`" .. codeName .. "`")
    end
end

-- === MAIN LOOP ===
spawn(function()
    while true do
        updateStats()
        scanRifts()
        scanEggs()

        -- Auto Blow (Dex this remote!)
        if state.autoBlow then
            -- RS.Remotes.BlowBubbleRemote:FireServer()
            wait(math.random(45, 55)/1000)
        end

        -- Auto Hatch
        if state.autoHatch and state.eggPriority then
            for _, egg in pairs(state.currentEggs) do
                if egg.name == state.eggPriority then
                    tpToModel(egg.instance)
                    break
                end
            end
        end

        -- Rift Priority
        if state.riftPriority then
            for _, rift in pairs(state.currentRifts) do
                if rift.name == state.riftPriority then
                    tpToModel(rift.instance)
                    break
                end
            end
        end

        wait(0.1)
    end
end)

-- === UI UPDATE LOOP ===
spawn(function()
    while true do
        local runtime = tick() - state.startTime
        local h = math.floor(runtime/3600)
        local m = math.floor((runtime%3600)/60)
        local s = math.floor(runtime%60)

        -- Update labels (Kavo doesn't have direct label update, using notifications)
        -- Stats webhook
        if state.webhookUrl ~= "" and state.webhookStats and tick() % 60 < 1 then
            local msg = "**ðŸ§¼ BGSI** " .. player.Name .. "\n"
            local fields = {}
            if state.stats.bubbles > 0 then table.insert(fields, "Bubbles: " .. state.stats.bubbles) end
            if state.stats.hatches > 0 then table.insert(fields, "Hatches: " .. state.stats.hatches) end
            if state.stats.coins > 0 then table.insert(fields, "Coins: " .. state.stats.coins) end
            if state.stats.gems > 0 then table.insert(fields, "Gems: " .. state.stats.gems) end
            if #fields > 0 then
                SendWebhook(state.webhookUrl, msg .. table.concat(fields, "\n"))
            end
        end

        wait(1)
    end
end)

-- Initial scans
scanEggs()
scanRifts()

print("ðŸŽ‰ BGSI Premium Hub FULLY LOADED!")
game.StarterGui:SetCore("SendNotification", {
    Title = "ðŸ§¼ BGSI Hub";
    Text = "Kavo UI loaded! Check F9 console for debug.";
    Duration = 5
})
