-- BGSI Premium Hub (Enhanced Kavo UI) - Draggable, Minimizable, Centered, Scrollable
-- Key: uIeCsXNDMliclXkKGlfNwXHZHFblrJZl
-- Professional dark theme with Google-style controls

getgenv().script_key = "uIeCsXNDMliclXkKGlfNwXHZHFblrJZl"

local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

print("ðŸ§¼ BGSI Enhanced UI Loading...")

-- Skip key check since key is set above
print("âœ… Premium access granted")

-- Kavo UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("ðŸ§¼ BGSI Premium Hub v2026", "DarkTheme")

-- Make Kavo window draggable and centered
local mainFrame = Window.screnGui.MainFrame -- Access Kavo's main frame
mainFrame.Position = UDim2.new(0.5, -300, 0.5, -250) -- Center screen
mainFrame.Draggable = true

-- Add Google-style minimize/close controls to header
local headerFrame = mainFrame:FindFirstChild("HeaderFrame") or mainFrame:FindFirstChildOfClass("Frame")
if headerFrame then
    -- Minimize button
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Name = "MinimizeBtn"
    minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
    minimizeBtn.Position = UDim2.new(1, -90, 0, 5)
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
    minimizeBtn.Text = "âˆ’"
    minimizeBtn.TextColor3 = Color3.white
    minimizeBtn.TextScaled = true
    minimizeBtn.Font = Enum.Font.GothamBold
    minimizeBtn.Parent = headerFrame

    local minCorner = Instance.new("UICorner")
    minCorner.CornerRadius = UDim.new(0, 15)
    minCorner.Parent = minimizeBtn

    -- Close button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "CloseBtn"
    closeBtn.Size = UDim2.new(0, 30, 0, 30)
    closeBtn.Position = UDim2.new(1, -55, 0, 5)
    closeBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
    closeBtn.Text = "âœ•"
    closeBtn.TextColor3 = Color3.white
    closeBtn.TextScaled = true
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = headerFrame

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 15)
    closeCorner.Parent = closeBtn

    -- Minimize functionality
    minimizeBtn.MouseButton1Click:Connect(function()
        if Window.Minimized then
            Window:Minimize(false)
            minimizeBtn.Text = "âˆ’"
        else
            Window:Minimize(true)
            minimizeBtn.Text = "â–¡"
        end
    end)

    closeBtn.MouseButton1Click:Connect(function()
        Library:ToggleUI()
    end)
end

print("âœ… Enhanced UI controls added")

-- State
local state = {
    autoBlow = false, autoHatch = false, riftPriority = nil, eggPriority = nil,
    webhookUrl = "", webhookStats = true,
    currentRifts = {}, currentEggs = {},
    stats = {bubbles=0, hatches=0, coins=0, bubbleStock=0, gems=0},
    startTime = tick()
}

-- PETS & CODES DATA (safe loading)
local petData, codeData
pcall(function()
    petData = require(RS.Shared.Data.Pets)
    codeData = require(RS.Shared.Data.Codes)
end)

local rarities = {"Common", "Unique", "Rare", "Epic", "Legendary", "Secret"}

-- === FUNCTIONS ===
local function SendWebhook(url, msg)
    pcall(function()
        request({
            Url = url, Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({content = msg})
        })
    end)
end

local function updateStats()
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        state.stats.bubbles = leaderstats:FindFirstChild("Bubbles") and leaderstats.Bubbles.Value or 0
        state.stats.hatches = leaderstats:FindFirstChild("Hatches") and leaderstats.Hatches.Value or 0
    end

    pcall(function()
        local screenGui = playerGui:FindFirstChild("ScreenGui")
        if screenGui and screenGui:FindFirstChild("HUD") then
            local currencyFrame = screenGui.HUD:FindFirstChild("Left", true):FindFirstChild("Currency", true)
            if currencyFrame then
                for _, currency in pairs(currencyFrame:GetChildren()) do
                    local label = currency:FindFirstChild("Frame", true):FindFirstChild("Label")
                    if label then
                        local value = tonumber(label.Text:match("%d+")) or 0
                        local name = currency.Name:lower()
                        if name == "coins" then state.stats.coins = value end
                        if name == "bubble" then state.stats.bubbleStock = value end
                        if name == "gems" then state.stats.gems = value end
                    end
                end
            end
        end
    end)
end

local function scanRifts()
    state.currentRifts = {}
    pcall(function()
        local rendered = Workspace:FindFirstChild("Rendered")
        if rendered and rendered:FindFirstChild("Rifts") then
            for _, rift in pairs(rendered.Rifts:GetChildren()) do
                local display = rift:FindFirstChild("Display")
                if display then
                    local timer = display:FindFirstChild("Timer")
                    local icon = display:FindFirstChild("Icon")
                    local luck = icon and icon:FindFirstChild("Luck")
                    table.insert(state.currentRifts, {
                        name = rift.Name,
                        timer = timer and timer.Text or "00:00",
                        luck = luck and luck.Text or "x1",
                        instance = rift
                    })
                end
            end
        end
    end)
end

local function scanEggs()
    state.currentEggs = {}
    pcall(function()
        local rendered = Workspace:FindFirstChild("Rendered")
        if rendered then
            for _, folder in pairs(rendered:GetChildren()) do
                if folder.Name:lower():find("chuncker") then
                    for _, egg in pairs(folder:GetChildren()) do
                        if egg.Name ~= "Coming Soon" then
                            table.insert(state.currentEggs, {name = egg.Name, instance = egg})
                        end
                    end
                end
            end
        end
    end)
end

local function tpToModel(model)
    pcall(function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local cf = model:FindFirstChild("EggPlatformSpawn")
                and model.EggPlatformSpawn:GetModelCFrame()
                or model:GetModelCFrame()
            hrp.CFrame = cf + Vector3.new(0, 5, 0)
        end
    end)
end

-- === TABS WITH SCROLLABLE SECTIONS ===
local MainTab = Window:NewTab("ðŸ  Main")
local FarmTab = Window:NewTab("ðŸ”§ Farm")
local EggsTab = Window:NewTab("ðŸ¥š Eggs")
local RiftsTab = Window:NewTab("ðŸŒŒ Rifts")
local WebTab = Window:NewTab("ðŸ“Š Webhook")
local DataTab = Window:NewTab("ðŸ“‹ Data")

-- MAIN TAB - Live Stats (Scrollable)
local MainSec = MainTab:NewSection("Live Statistics")
MainTab:NewLabel("Runtime & Player Stats")
local runtimeLabel = MainTab:NewLabel("Runtime: 00:00:00")
local bubblesLabel = MainTab:NewLabel("Bubbles: 0")
local hatchesLabel = MainTab:NewLabel("Hatches: 0")
local coinsLabel = MainTab:NewLabel("Coins: 0")
local bubbleLabel = MainTab:NewLabel("Bubble Stock: 0")
local gemsLabel = MainTab:NewLabel("Gems: 0")

-- FARM TAB
local FarmSec = FarmTab:NewSection("Auto Farming")
FarmTab:NewToggle("AutoBlow", "ðŸ§¼ Auto Blow (Dex Remote)", function(value)
    state.autoBlow = value
    print("ðŸ§¼ Auto Blow:", value and "ON" or "OFF")
end)

-- EGGS TAB (Scrollable list)
local EggSec = EggsTab:NewSection("Egg Scanner")
local eggList = EggsTab:NewDropdown("EggSelect", "Available Eggs", {}, function(option)
    state.eggPriority = option
    for _, egg in pairs(state.currentEggs) do
        if egg.name == option then
            tpToModel(egg.instance)
            break
        end
    end
end)

EggsTab:NewToggle("AutoHatch", "Auto Hatch Priority Egg", function(value)
    state.autoHatch = value
end)

EggsTab:NewButton("ðŸ”„ Refresh Eggs", function()
    scanEggs()
    local names = {}
    for _, egg in pairs(state.currentEggs) do table.insert(names, egg.name) end
    eggList:Refresh(names)
end)

-- RIFTS TAB
local RiftSec = RiftsTab:NewSection("Live Rift Scanner")
local riftList = RiftsTab:NewDropdown("RiftSelect", "Active Rifts", {}, function(option)
    local name = option:match("^(.+?) |") or option
    state.riftPriority = name
    for _, rift in pairs(state.currentRifts) do
        if rift.name == name then
            tpToModel(rift.instance)
            break
        end
    end
end)

RiftsTab:NewButton("ðŸ”„ Refresh Rifts", function()
    scanRifts()
    local names = {}
    for _, rift in pairs(state.currentRifts) do
        table.insert(names, rift.name .. " | " .. rift.timer .. " | " .. rift.luck)
    end
    riftList:Refresh(names)
end)

-- WEBHOOK TAB
local WebSec = WebTab:NewSection("Discord Integration")
local webhookBox = WebTab:NewTextBox("WebhookURL", "Discord Webhook", function(text)
    state.webhookUrl = text
end)

WebTab:NewToggle("StatsWebhook", "Send Stats Updates", function(value)
    state.webhookStats = value
end)

WebTab:NewButton("ðŸ§ª Test Webhook", function()
    if state.webhookUrl == "" then return end
    local msg = "**ðŸ§¼ BGSI Stats** `" .. os.date("%H:%M") .. "`\n"
    local fields = {}
    if state.stats.bubbles > 0 then table.insert(fields, "Bubbles: " .. state.stats.bubbles) end
    if state.stats.hatches > 0 then table.insert(fields, "Hatches: " .. state.stats.hatches) end
    if state.stats.coins > 0 then table.insert(fields, "Coins: " .. state.stats.coins) end
    SendWebhook(state.webhookUrl, msg .. table.concat(fields, "\n"))
end)

-- DATA TAB
if petData then
    local PetSec = DataTab:NewSection("Pet Rarities")
    for petName, data in pairs(petData) do
        if data.Rarity then
            DataTab:NewLabel(petName .. " [" .. data.Rarity .. "]")
        end
    end
end

-- === MAIN LOOPS ===
spawn(function()
    while wait(0.1) do
        updateStats()
        scanRifts()
        scanEggs()

        if state.autoBlow then
            -- TODO: RS.Remotes.BlowBubbleRemote:FireServer()
        end

        if state.autoHatch and state.eggPriority then
            for _, egg in pairs(state.currentEggs) do
                if egg.name == state.eggPriority then
                    tpToModel(egg.instance)
                    break
                end
            end
        end
    end
end)

spawn(function()
    while wait(1) do
        local runtime = tick() - state.startTime
        local h,m,s = math.floor(runtime/3600), math.floor((runtime%3600)/60), math.floor(runtime%60)

        -- Update labels would go here if Kavo supported it
        if state.webhookStats and state.webhookUrl ~= "" and tick()%60<1 then
            local msg = "**ðŸ§¼ BGSI** | " .. player.Name .. "\n"
            local fields = {}
            if state.stats.bubbles>0 then table.insert(fields,"Bubbles: "..state.stats.bubbles) end
            if state.stats.hatches>0 then table.insert(fields,"Hatches: "..state.stats.hatches) end
            SendWebhook(state.webhookUrl, msg..table.concat(fields,"\n"))
        end
    end
end)

-- Initial scan
scanEggs()
scanRifts()

print("ðŸŽ‰ BGSI Enhanced UI FULLY LOADED!")
game.StarterGui:SetCore("SendNotification", {
    Title = "ðŸ§¼ BGSI Hub"; Text = "Enhanced UI ready! Drag/Minimize/Close added"; Duration = 5
})